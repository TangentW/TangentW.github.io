<!DOCTYPE html>


  <html class="light">


<head>
  <meta charset="utf-8">
  
  <title>探究在iOS开发中实现VIPER架构 | Tangent</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="iOS,Swift,VIPER,VIP," />
  

  <meta name="description" content="前言在软件开发中，架构是至关重要的一部分，就好比盖房子需要基本的钢筋石桩等骨架，常听到的架构有MVC、MVP、MVVM、VIPER等，其中，MVC是我们最常用的软件架构模式，而苹果的整个API框架都是使用MVC作为架构的，所以我们会看到一些iOS的API中有这些类:UIXXXViewController、UIXXXView，而现在比较兴起的架构当属MVP和MVVM，我个人觉得这它们是非常相似的，但">
<meta property="og:type" content="article">
<meta property="og:title" content="探究在iOS开发中实现VIPER架构">
<meta property="og:url" content="http://yoursite.com/2016/12/07/探究在iOS开发中实现VIPER架构/index.html">
<meta property="og:site_name" content="Tangent">
<meta property="og:description" content="前言在软件开发中，架构是至关重要的一部分，就好比盖房子需要基本的钢筋石桩等骨架，常听到的架构有MVC、MVP、MVVM、VIPER等，其中，MVC是我们最常用的软件架构模式，而苹果的整个API框架都是使用MVC作为架构的，所以我们会看到一些iOS的API中有这些类:UIXXXViewController、UIXXXView，而现在比较兴起的架构当属MVP和MVVM，我个人觉得这它们是非常相似的，但">
<meta property="og:image" content="http://7xsfp9.com1.z0.glb.clouddn.com/viper.jpeg">
<meta property="og:image" content="http://7xsfp9.com1.z0.glb.clouddn.com/instance.gif">
<meta property="og:updated_time" content="2016-12-07T08:41:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="探究在iOS开发中实现VIPER架构">
<meta name="twitter:description" content="前言在软件开发中，架构是至关重要的一部分，就好比盖房子需要基本的钢筋石桩等骨架，常听到的架构有MVC、MVP、MVVM、VIPER等，其中，MVC是我们最常用的软件架构模式，而苹果的整个API框架都是使用MVC作为架构的，所以我们会看到一些iOS的API中有这些类:UIXXXViewController、UIXXXView，而现在比较兴起的架构当属MVP和MVVM，我个人觉得这它们是非常相似的，但">
<meta name="twitter:image" content="http://7xsfp9.com1.z0.glb.clouddn.com/viper.jpeg">

  

  
    <link rel="icon" href="/images/icon.ico">
  
  
  <link href="/css/styles.css?v=5f7f1d39" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?0e70ef65f0d3c8a1e0d427edc322fc77";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


</head>

<body>

  
    <a href="#modal-one" class="toolbox-mobile">盒子</a>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/project/"
            target="_self"
            >
            GitHub
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            target="_self"
            >
            友链
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是-VIPER"><span class="toc-text">什么是 VIPER</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何配置-VIPER"><span class="toc-text">如何配置 VIPER</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#协议"><span class="toc-text">协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#抽象基类"><span class="toc-text">抽象基类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#绑定器与联合体"><span class="toc-text">绑定器与联合体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#路由器"><span class="toc-text">路由器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-VIPER"><span class="toc-text">使用 VIPER</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#服务器端构建"><span class="toc-text">服务器端构建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#依赖"><span class="toc-text">依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实体-Entity"><span class="toc-text">实体 Entity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#One-联合体"><span class="toc-text">One 联合体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#View"><span class="toc-text">View</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Interactor"><span class="toc-text">Interactor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Presenter"><span class="toc-text">Presenter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Two-联合体"><span class="toc-text">Two 联合体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AppDelegate"><span class="toc-text">AppDelegate</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结-amp-链接"><span class="toc-text">总结 & 链接</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-探究在iOS开发中实现VIPER架构" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">探究在iOS开发中实现VIPER架构</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2016.12.07</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>Tangent 汤骏炜</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/iOS/">iOS</a>
  </span>



      

    </div>
  </header>

  <div class="article-content">
    
      <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在软件开发中，架构是至关重要的一部分，就好比盖房子需要基本的钢筋石桩等骨架，常听到的架构有<code>MVC</code>、<code>MVP</code>、<code>MVVM</code>、<code>VIPER</code>等，其中，<code>MVC</code>是我们最常用的软件架构模式，而苹果的整个API框架都是使用<code>MVC</code>作为架构的，所以我们会看到一些iOS的API中有这些类:<code>UIXXXViewController</code>、<code>UIXXXView</code>，而现在比较兴起的架构当属<code>MVP</code>和<code>MVVM</code>，我个人觉得这它们是非常相似的，但在之前我使用第三方函数式、响应式框架<code>RxSwift</code>或<code>ReactiveCocoa</code>去实现<code>MVP</code>或<code>MVVM</code>架构时，我自认为，<code>MVP</code>中的<code>Presenter</code>专注于事件、数据的转换，成为<code>View</code>层及<code>Model</code>层的一条流通管道，而<code>MVVM</code>中的<code>ViewModel</code>更像是一个装有视图显示数据的，并带有一些显示逻辑处理的分层，然后我们可以将<code>ViewModel</code>中的显示数据与<code>View</code>中的视图进行响应式绑定（个人观点，若有误，望各位纠正）。在现在的开发中，我也是使用<code>MVP</code>或<code>MVVM</code>架构。而<code>VIPER</code>架构，一开始我是只听过其名，并未深入了解，也并未实战使用，直到某个契机我看到大神<a href="http://weibo.com/u/1840543654" target="_blank" rel="external">@罗琦aidenluo</a>的iOS架构讲解视频，了解到了<code>VIPER</code>架构，受益匪浅，这篇文章是我对<code>VIPER</code>学习以及实践的总结，主要简单介绍<code>VIPER</code>架构以及其怎样使用<code>Swift3.0</code>语言在iOS平台上实现。</p>
<p>文章所对应的代码我已经放到了我的Github上<a href="https://github.com/TangentW/TanVIPER" target="_blank" rel="external">TanVIPER</a>，欢迎Click入~</p>
<h2 id="什么是-VIPER"><a href="#什么是-VIPER" class="headerlink" title="什么是 VIPER"></a>什么是 VIPER</h2><p>传统的<code>MVC</code>架构中，我们都知道，其<code>Controller(控制器)</code>层接纳了太多的任务，当开发不断进行，其内部的业务逻辑逐渐积累，最后则会变得臃肿不堪，不便于后期的调试测试以及多人协助，所以，我们需要寻找减轻<code>Controller</code>层负担的方法，而<code>VIPER</code>架构其实是将<code>Controller</code>再细分成三层，分别是<code>View</code>、<code>Interactor</code>、<code>Presenter</code>，已达到减轻<code>Controller</code>层负担的作用。</p>
<p><code>VIPER</code>中每个字母的意思是如下：</p>
<ul>
<li><strong>V: View</strong>  <strong>视图</strong>：在这里并不是指传统的<code>UIView</code>或其子类，事实上它就是<code>UIViewController</code>，在前面所说到，<code>VIPER</code>架构主要是将<code>MVC</code>架构中的<code>Controller</code>进行更加细致的划分，而<code>View(视图)</code>层则是主要负责一些视图的显示、布局，用户事件的接受以及转发，基本的显示逻辑处理等等工作。</li>
<li><strong>I: Interactor</strong>  <strong>交互器</strong>：其为<code>VIPER</code>的中心枢纽，主要负责交互的工作，例如数据的请求（网络请求、本地持久化层请求）、某些业务逻辑的处理，在这里我们得到的数据是原始数据，需要经过解析处理转换成能够直接应用于视图的视图模型数据，所以我们需要用到了下一层<code>Presenter(展示器)</code>。</li>
<li><strong>P: Presenter</strong>  <strong>展示器</strong>：当我们在上一层<code>Interactor(交互器)</code>中获得原始数据后，我们需要将数据进行解析处理，比如我们在交互器中进行了网络请求，得到了json数据，若要将json中所包含的内容显示出来，我们则需要将json数据进行解析，展示器就是专注于数据的解析转换，将原始的数据转换成最终能够直接显示在试图上的视图模型数据。此外，展示器中还带有路由器<code>Router</code>，可以进行路由的操作。</li>
<li><strong>E: Entity</strong>  <strong>实体模型对象</strong></li>
<li><strong>R: Router</strong>  <strong>路由器</strong>： 负责视图的跳转，因为使用<code>VIPER</code>架构需要进行各层之间的相互绑定，所以视图的跳转不能简单地使用原始的方法。</li>
</ul>
<p>下面是一张<code>VIPER</code>的简单逻辑图：<br><img src="http://7xsfp9.com1.z0.glb.clouddn.com/viper.jpeg" alt=""><br>图中，箭头代表着数据流的传递，我们可以看到，在<code>VIPER</code>架构中，数据的流向总是<code>单向流动</code>，在<code>View</code>、<code>Interactor</code>、<code>Presenter</code>三层中形成了一个流动闭环，而在其他的某些架构中，如<code>MVC</code>、<code>MVP</code>、<code>MVVM</code>，它们的数据在中间层会有着双向的流动，<code>VIPER</code>较它们而言，其更加约束了整个软件的架构，每一层功能特定，数据的流向单一，使得软件在开发中对原架构的高度切合。</p>
<h2 id="如何配置-VIPER"><a href="#如何配置-VIPER" class="headerlink" title="如何配置 VIPER"></a>如何配置 VIPER</h2><p>在对<code>VIPER</code>架构的实现中，我是基于<a href="http://weibo.com/u/1840543654" target="_blank" rel="external">@罗琦aidenluo</a>的<code>VIP</code>架构思想，稍作添加改动。使用的语言是<code>Swift 3.0</code>。</p>
<h3 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h3><p>我们先指定好一套协议，用于规范好<code>VIPER</code>各层间的绑定与联系。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  MARK: - Protocol</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ViewToInteratorPipline</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">refresh</span><span class="params">(request: Request)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">InteratorToPresenterPipline</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(response: Response)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">PresenterToViewPipline</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">display</span><span class="params">(viewModel: ViewModel)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Request</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Response</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ViewModel</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure></p>
<p>如上，有三个管道协议，用于连通<code>View</code>、<code>Interactor</code>、<code>Presenter</code>三层；在<code>View</code>通向<code>Interactor</code>管道中，通过方法<code>refresh(request:)</code>来让<code>View</code>请求<code>Interactor</code>去进行刷新；在<code>Interactor</code>通向<code>Presenter</code>管道中，通过方法<code>present(response:)</code>来让<code>Interactor</code>将原始数据传递给<code>Presenter</code>让其进行数据的解析处理；在<code>Presenter</code>通向<code>View</code>管道中，通过<code>display(viewModel:)</code>方法来让<code>Presenter</code>将视图模型传递给<code>View</code>然后让其显示。三层环环相扣。</p>
<h3 id="抽象基类"><a href="#抽象基类" class="headerlink" title="抽象基类"></a>抽象基类</h3><p>在之前曾想过使用<code>Swift</code>的面向协议编程来对各层进行实现，但是考虑到一些动态创建以及各层的绑定问题，所以最后使用的是抽象基类方法。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  MARK: - Abstract Class</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">View</span>: <span class="title">ViewController</span>, <span class="title">PresenterToViewPipline</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">let</span> interator: <span class="type">Interactor</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>(interator: <span class="type">Interactor</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.interator = interator</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(nibName: <span class="literal">nil</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"init(coder:) has not been implemented"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">display</span><span class="params">(viewModel: ViewModel)</span></span> &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"display(viewModel:) is an abstract function"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">(route: Router, userInfo: Any?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"show(route:userInfo:) is an abstract function"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Interactor</span>: <span class="title">ViewToInteratorPipline</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">let</span> presenter: <span class="type">Presenter</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>(presenter: <span class="type">Presenter</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.presenter = presenter</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">refresh</span><span class="params">(request: Request)</span></span> &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"refresh(request:) is an abstract function"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Presenter</span>: <span class="title">InteratorToPresenterPipline</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">weak</span> <span class="keyword">var</span> _view: <span class="type">View</span>? &#123;  <span class="comment">//  !! Weak !!</span></span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>._router = <span class="type">Router</span>(presenter: <span class="keyword">self</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">var</span> _router: <span class="type">Router</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">var</span> view: <span class="type">View</span>? &#123;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="built_in">assert</span>(<span class="keyword">self</span>._view == <span class="literal">nil</span>, <span class="string">"view has already set!"</span>)</span><br><span class="line">            <span class="keyword">self</span>._view = newValue</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>._view</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">var</span> router: <span class="type">Router</span>? &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>._router</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(response: Response)</span></span> &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"response(Response:) is an abstract function"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如上代码所示，定义了三个抽象基类，分别代表了<code>View</code>、<code>Interactor</code>、<code>Presenter</code>三层，它们各自实现了管道协议，每一个抽象基类中都持有其下一层的基类，在构造方法中进行初始化。如<code>View</code>类中持有了<code>Interactor</code>类的属性，作用是进行层与层之间的数据传输。<br>这里细讲一下：</p>
<ul>
<li><strong>View</strong>是直接继承于<code>ViewController</code>的，所以在<code>VIPER</code>中，我们将<code>View</code>指代了<code>ViewController</code>，并且，<code>View</code>除了实现管道协议外，其内部还有一个<code>show(router:userInfo:)</code>的抽象方法，此方法可用于路由跳转时数据的传输，将一些数据在跳转前传输到目标跳转视图中。</li>
<li><strong>Presenter</strong>中的<code>View</code>是<code>weak</code>弱引用类型，因为在<code>View</code>、<code>Interactor</code>、<code>Presenter</code>三层绑定时有引用环形成，如果不将引用环中的某个引用设为弱引用，则会出现<code>循环引用</code>现象。此外，<code>Presenter</code>中还具有路由器<code>Router</code>，我们在<code>Presenter</code>中可以利用路由器进行页面的跳转。</li>
</ul>
<h3 id="绑定器与联合体"><a href="#绑定器与联合体" class="headerlink" title="绑定器与联合体"></a>绑定器与联合体</h3><p>我们在使用<code>VIPER</code>时，需要将各层进行绑定，比如<code>OneView</code>的交互器要绑定<code>OneInteractor</code>，而<code>OneInteractor</code>的展示器要绑定<code>OnePresenter</code>，因为绑定的操作频繁，所以我这里将层之间的绑定操作封装成了绑定器<code>Binder</code>。联合体就是将要绑定在一起的<code>View</code>、<code>Interactor</code>、<code>Presenter</code>封装成模型。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  MARK: - Unity</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Unity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> viewType: <span class="type">View</span>.<span class="type">Type</span></span><br><span class="line">    <span class="keyword">let</span> interatorType: <span class="type">Interactor</span>.<span class="type">Type</span></span><br><span class="line">    <span class="keyword">let</span> presenterType: <span class="type">Presenter</span>.<span class="type">Type</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Unity</span>: <span class="title">ExpressibleByArrayLiteral</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Element</span> = <span class="type">AnyClass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(arrayLiteral elements: <span class="type">Unity</span>.<span class="type">Element</span>...) &#123;</span><br><span class="line">        <span class="built_in">assert</span>(elements.<span class="built_in">count</span> == <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> viewType = elements[<span class="number">0</span>] <span class="keyword">as</span>? <span class="type">View</span>.<span class="type">Type</span> <span class="keyword">else</span> &#123; <span class="built_in">assert</span>(<span class="literal">false</span>) &#125;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> interactorType = elements[<span class="number">1</span>] <span class="keyword">as</span>? <span class="type">Interactor</span>.<span class="type">Type</span> <span class="keyword">else</span> &#123; <span class="built_in">assert</span>(<span class="literal">false</span>) &#125;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> presenterType = elements[<span class="number">2</span>] <span class="keyword">as</span>? <span class="type">Presenter</span>.<span class="type">Type</span> <span class="keyword">else</span> &#123; <span class="built_in">assert</span>(<span class="literal">false</span>) &#125;</span><br><span class="line">        <span class="keyword">self</span>.viewType = viewType</span><br><span class="line">        <span class="keyword">self</span>.interatorType = interactorType</span><br><span class="line">        <span class="keyword">self</span>.presenterType = presenterType</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  MARK: - Binder</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Binder</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> unitySet: [<span class="type">String</span>: <span class="type">Unity</span>] = [:]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">addUnity</span><span class="params">(<span class="number">_</span> unity: Unity, identifier: String)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.unitySet[identifier] = unity</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">obtainView</span><span class="params">(identifier: String)</span></span> -&gt; <span class="type">View</span>? &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> unity = <span class="keyword">self</span>.unitySet[identifier] <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//  Bind</span></span><br><span class="line">        <span class="keyword">let</span> presenter = unity.presenterType.<span class="keyword">init</span>()</span><br><span class="line">        <span class="keyword">let</span> interator = unity.interatorType.<span class="keyword">init</span>(presenter: presenter)</span><br><span class="line">        <span class="keyword">let</span> view = unity.viewType.<span class="keyword">init</span>(interator: interator)</span><br><span class="line">        presenter.view = view</span><br><span class="line">        <span class="keyword">return</span> view</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>Unity</strong> 联合体实现了字面量表达式的协议，我们能直接通过列表来构建联合体，而在联合体中储存的是三个分层的类型，用于绑定器的分层动态生成与绑定。</li>
<li><strong>Binder</strong> 绑定器职责是将其里面储存的联合体中的三个分层进行绑定， 我们通过<code>obtainView(identifier:)</code>方法，传入标识符对<code>View</code>进行索取，在此方法返回前，就自动帮我们进行三层的绑定。在对<code>View</code>进行索取前，必须先进行联合体的添加配置，使用的是<code>addUnity(_, identifier:)</code>方法，一般我们可以在<code>AppDelegate</code>的<code>application(_, didFinishLaunchingWithOptions:)</code>方法中进行绑定器的初始化配置。</li>
</ul>
<h3 id="路由器"><a href="#路由器" class="headerlink" title="路由器"></a>路由器</h3><p>路由器主要是负责视图的跳转，它位于<code>Presnter</code>层，以下是它的代码：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  MARK: - Router</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">RouteType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> root(identifier: <span class="type">String</span>)</span><br><span class="line">    <span class="keyword">case</span> push(identifier: <span class="type">String</span>)</span><br><span class="line">    <span class="keyword">case</span> modal(identifier: <span class="type">String</span>)</span><br><span class="line">    <span class="keyword">case</span> back</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">RouteType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> identifier: <span class="type">String</span>? &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .root(identifier):</span><br><span class="line">            <span class="keyword">return</span> identifier</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .push(identifier):</span><br><span class="line">            <span class="keyword">return</span> identifier</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .modal(identifier):</span><br><span class="line">            <span class="keyword">return</span> identifier</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> view: <span class="type">View</span>? &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> identifier = <span class="keyword">self</span>.identifier <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Binder</span>.obtainView(identifier: identifier)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Router</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> presenter: <span class="type">Presenter</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>(presenter: <span class="type">Presenter</span>? = <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.presenter = presenter</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">route</span><span class="params">(type: RouteType, userInfo: Any?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> view = type.view</span><br><span class="line">        view?.show(router: <span class="keyword">self</span>, userInfo: userInfo)</span><br><span class="line">        <span class="keyword">switch</span> type &#123;</span><br><span class="line">        <span class="keyword">case</span> .root:</span><br><span class="line">            <span class="type">UIApplication</span>.shared.keyWindow?.rootViewController = view</span><br><span class="line">        <span class="keyword">case</span> .push:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> view = view &#123; <span class="keyword">self</span>.presenter?.view?.navigationController?.pushViewController(view, animated: <span class="literal">true</span>) &#125;</span><br><span class="line">        <span class="keyword">case</span> .modal:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> view = view &#123; <span class="keyword">self</span>.presenter?.view?.present(view, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>) &#125;</span><br><span class="line">        <span class="keyword">case</span> .back:</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> view = presenter?.view <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">            <span class="keyword">if</span> view.presentationController != <span class="literal">nil</span> &#123;</span><br><span class="line">                view.dismiss(animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="number">_</span> = view.navigationController?.popViewController(animated: <span class="literal">true</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我定义的这个路由器比较简单，有四种跳转的方式：</p>
<ol>
<li>模态跳转</li>
<li>导航跳转</li>
<li>根视图切换</li>
<li>返回<br>其中，根视图切换是针对应用程序主窗口<code>KeyWindow</code>的根视图进行切换，一般在应用程序启动时应用。</li>
</ol>
<p>这里，我们进行跳转不像是传统的那样传入<code>ViewController</code>实例，而是直接传入联合体的标识符，路由器会利用此标识符经过绑定器的动态生成及绑定，获取到要跳转的视图，从而进行跳转。<br>在跳转时，我们可以将一些附带数据传入<code>userInfo</code>参数中，这些数据能在跳转前于目标跳转视图的<code>show(router:userInfo:)</code>方法中获取到。</p>
<hr>
<p>到此，<code>VIPER</code>架构的基本配置就已经搭好了。</p>
<h2 id="使用-VIPER"><a href="#使用-VIPER" class="headerlink" title="使用 VIPER"></a>使用 VIPER</h2><p>下面我们通过<code>VIPER</code>架构来做一个实例，主要包含两个需求，一个是用户的登录，另一个是视图的跳转。<br>上GIF图~<br><img src="http://7xsfp9.com1.z0.glb.clouddn.com/instance.gif" alt=""><br>如图所示，主页面有两个按钮，一个是用于将视图跳转到另一个页面，二哥则是将输入的用户名及密码进行验证登录。</p>
<p>下面就开工吧~</p>
<h3 id="服务器端构建"><a href="#服务器端构建" class="headerlink" title="服务器端构建"></a>服务器端构建</h3><p>服务器端这里我写的比较简单，只是进行一些死数据的判断以及json输出，使用的是<code>PHP</code>语言：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//  TanVIPER Server</span></span><br><span class="line"></span><br><span class="line">$userName = <span class="keyword">isset</span>($_POST[<span class="string">'user_name'</span>]) ? $_POST[<span class="string">'user_name'</span>] : <span class="string">''</span>;</span><br><span class="line">$password = <span class="keyword">isset</span>($_POST[<span class="string">'password'</span>]) ? $_POST[<span class="string">'password'</span>] : <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">$out = check($userName, $password);</span><br><span class="line"><span class="keyword">echo</span> json_encode($out, JSON_UNESCAPED_UNICODE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  Code: 200  --&gt; Success , 300  --&gt; Faild</span></span><br><span class="line"><span class="comment">//  Function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">($userName, $password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($userName == <span class="string">'tangent'</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($password == <span class="string">'123456'</span>) &#123;</span><br><span class="line">            $userInfo = <span class="keyword">array</span>(<span class="string">'name'</span> =&gt; <span class="string">'tangent'</span>, <span class="string">'gender'</span> =&gt; <span class="number">1</span>, <span class="string">'token'</span> =&gt; <span class="string">'11233'</span>, <span class="string">'age'</span> =&gt; <span class="number">20</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">'code'</span> =&gt; <span class="number">200</span>, <span class="string">'message'</span> =&gt; <span class="string">'登录成功'</span>, <span class="string">'user_info'</span> =&gt; $userInfo);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">'code'</span> =&gt; <span class="number">300</span>, <span class="string">'message'</span> =&gt; <span class="string">'密码错误'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">'code'</span> =&gt; <span class="number">300</span>, <span class="string">'message'</span> =&gt; <span class="string">'不存在此用户'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<hr>
<p>接下来，就是手机iOS端的搭构</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p>在此实例中涉及了网络请求、json数据解析、自动布局等等需求，所以我们利用<code>CocoaPods</code>引入一些第三方依赖库。</p>
<ul>
<li>Moya 用于网络请求</li>
<li>SnapKit 用于自动布局</li>
<li>Argo、Curry 用于JSON数据转模型</li>
</ul>
<h3 id="实体-Entity"><a href="#实体-Entity" class="headerlink" title="实体 Entity"></a>实体 Entity</h3><p>这个项目有两个联合体，我分别起名叫<code>One</code>和<code>Two</code>：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  MARK: - VIPERs</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">VIPERs</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> one</span><br><span class="line">    <span class="keyword">case</span> two</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">VIPERs</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> identifier: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.rawValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在前面说到，绑定器以及路由都是通过联合体的标识符来唯一标识的，所以这里我让枚举的原始值类型为字符串，并在扩展中添加了获取标识符的方法。</p>
<hr>
<p>针对不同的联合体，<code>Request</code>、<code>Response</code>、<code>ViewModel</code>有所不同，所以这里我们定义两个联合体的各种实体模型：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  One</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">OneRequest</span>: <span class="title">Request</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> jump</span><br><span class="line">    <span class="keyword">case</span> login(userName: <span class="type">String</span>, password: <span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">OneResponse</span>: <span class="title">Response</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> jumpResponse(viper: <span class="type">VIPERs</span>)</span><br><span class="line">    <span class="keyword">case</span> loginResponse(json: <span class="type">Any</span>?)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">OneViewModel</span>: <span class="title">ViewModel</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> alertMessage: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(alertMessage: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.alertMessage = alertMessage</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  Two</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">TwoRequest</span>: <span class="title">Request</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> back</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">TwoResponse</span>: <span class="title">Response</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> back</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>当我们启动应用时，我们需要对<code>Binder(绑定器)</code>进行初始化，将应用的所以联合体进行添加配置，这里我就封装了一个结构体，专门用于绑定器的初始化：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  MARK: - BinderHelper</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BinderHelper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">initBinder</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">Binder</span>.addUnity([<span class="type">OneView</span>.<span class="keyword">self</span>, <span class="type">OneInteractor</span>.<span class="keyword">self</span>, <span class="type">OnePresenter</span>.<span class="keyword">self</span>], identifier: <span class="type">VIPERs</span>.one.identifier)</span><br><span class="line">        <span class="type">Binder</span>.addUnity([<span class="type">TwoView</span>.<span class="keyword">self</span>, <span class="type">TwoInteractor</span>.<span class="keyword">self</span>, <span class="type">TwoPresenter</span>.<span class="keyword">self</span>], identifier: <span class="type">VIPERs</span>.two.identifier)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们在应用刚启动的时候就可以调用里面的初始化方法。</p>
<hr>
<p>我将从网络获取到的响应数据以及其中的用户数据封装成一个模型实体：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  MARK: - User</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">UserGender</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> male = <span class="string">"男"</span></span><br><span class="line">    <span class="keyword">case</span> female = <span class="string">"女"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> age: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> gender: <span class="type">UserGender</span></span><br><span class="line">    <span class="keyword">let</span> token: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">User</span>: <span class="title">CustomStringConvertible</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"姓名: \(self.name), 年龄: \(self.age), 性别: \(self.gender.rawValue), 令牌: \(self.token)"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">User</span>: <span class="title">Decodable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">decode</span><span class="params">(<span class="number">_</span> json: JSON)</span></span> -&gt; <span class="type">Decoded</span>&lt;<span class="type">User</span>&gt; &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> genderMapper: (<span class="type">Int</span>) -&gt; <span class="type">UserGender</span> = &#123; genderType <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> genderType == <span class="number">1</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> .male</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> .female</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> curry(<span class="keyword">self</span>.<span class="keyword">init</span>)</span><br><span class="line">            &lt;^&gt; json &lt;| <span class="string">"name"</span></span><br><span class="line">            &lt;*&gt; json &lt;| <span class="string">"age"</span></span><br><span class="line">            &lt;*&gt; (genderMapper &lt;^&gt; json &lt;| <span class="string">"gender"</span>)</span><br><span class="line">            &lt;*&gt; json &lt;| <span class="string">"token"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  MARK: - Network Response</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">NetworkResponse</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> faild(message: <span class="type">String</span>)</span><br><span class="line">    <span class="keyword">case</span> success(user: <span class="type">User</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NetworkResponse</span>: <span class="title">Decodable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(code: <span class="type">Int</span>, message: <span class="type">String</span>, userInfo: <span class="type">User</span>?) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> user = userInfo, code == <span class="number">200</span> &#123;</span><br><span class="line">            <span class="keyword">self</span> = .success(user: user)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">self</span> = .faild(message: message)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">decode</span><span class="params">(<span class="number">_</span> json: JSON)</span></span> -&gt; <span class="type">Decoded</span>&lt;<span class="type">NetworkResponse</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> curry(<span class="keyword">self</span>.<span class="keyword">init</span>)</span><br><span class="line">            &lt;^&gt; json &lt;| <span class="string">"code"</span></span><br><span class="line">            &lt;*&gt; json &lt;| <span class="string">"message"</span></span><br><span class="line">            &lt;*&gt; json &lt;|? <span class="string">"user_info"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其中，实体的<code>Decodable</code>扩展是<code>Argo</code>框架中用于json的数据转模型的实现。</p>
<hr>
<p>由于我们使用了网络请求框架<code>Moya</code>，它需要我们提供一个请求的目标实体：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  MARK: - Network Request</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">NetworkRequest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> login(userName: <span class="type">String</span>, password: <span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NetworkRequest</span>: <span class="title">TargetType</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> baseURL: <span class="type">URL</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">URL</span>(string: <span class="string">"http://127.0.0.1"</span>)!</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> path: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .login:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"/projects/tanviper.php"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> method: <span class="type">Moya</span>.<span class="type">Method</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .post</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> parameters: [<span class="type">String</span>: <span class="type">Any</span>]? &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .login(userName, password):</span><br><span class="line">            <span class="keyword">return</span> [<span class="string">"user_name"</span>: userName, <span class="string">"password"</span>: password]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> sampleData: <span class="type">Data</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&#123;\"code\": \"300\", \"message\": \"不存在此用户\"&#125;"</span>.data(using: .utf8)!</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> task: <span class="type">Task</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .request</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个请求实体只有一项登录功能，在这里，我连接的是本地的服务器。</p>
<h3 id="One-联合体"><a href="#One-联合体" class="headerlink" title="One 联合体"></a>One 联合体</h3><p>接下来就开始构建联合体了，先看回上面所说到的用于初始化绑定器的实体的绑定器初始化方法：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Binder</span>.addUnity([<span class="type">OneView</span>.<span class="keyword">self</span>, <span class="type">OneInteractor</span>.<span class="keyword">self</span>, <span class="type">OnePresenter</span>.<span class="keyword">self</span>], identifier: <span class="type">VIPERs</span>.one.identifier)</span><br><span class="line"><span class="type">Binder</span>.addUnity([<span class="type">TwoView</span>.<span class="keyword">self</span>, <span class="type">TwoInteractor</span>.<span class="keyword">self</span>, <span class="type">TwoPresenter</span>.<span class="keyword">self</span>], identifier: <span class="type">VIPERs</span>.two.identifier)</span><br></pre></td></tr></table></figure></p>
<p>我们可以看到，对于One联合体来说，它的组成为<code>OneView</code>、<code>OneInteractor</code>、<code>OnePresenter</code>，对于Two联合体来说是<code>TwoView</code>、<code>TwoInteractor</code>、<code>TwoPresenter</code>，所以我们需要创建这两个联合体的每个组成部分。</p>
<p>对于One联合体：</p>
<h4 id="View"><a href="#View" class="headerlink" title="View"></a>View</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> SnapKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OneView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  MARK: - Life Cycle</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="keyword">self</span>.view.backgroundColor = <span class="type">UIColor</span>.white</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.buttonListener = <span class="type">OneViewButtonListener</span>(jump: &#123; </span><br><span class="line">            <span class="keyword">self</span>.interator.refresh(request: <span class="type">OneRequest</span>.jump)</span><br><span class="line">        &#125;, login: &#123;</span><br><span class="line">            <span class="keyword">self</span>.interator.refresh(request: <span class="type">OneRequest</span>.login(userName: <span class="keyword">self</span>.userNameInput.text!, password: <span class="keyword">self</span>.passwordInput.text!))</span><br><span class="line">            <span class="keyword">self</span>.loginButton.isEnabled = <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.view.addSubview(<span class="keyword">self</span>.jumpButton)</span><br><span class="line">        <span class="keyword">self</span>.view.addSubview(<span class="keyword">self</span>.loginButton)</span><br><span class="line">        <span class="keyword">self</span>.view.addSubview(<span class="keyword">self</span>.userNameInput)</span><br><span class="line">        <span class="keyword">self</span>.view.addSubview(<span class="keyword">self</span>.passwordInput)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.layoutViews()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  Override</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">display</span><span class="params">(viewModel: ViewModel)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.loginButton.isEnabled = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">let</span> alertMessage = (viewModel <span class="keyword">as</span>! <span class="type">OneViewModel</span>).alertMessage</span><br><span class="line">        <span class="keyword">self</span>.alertController.message = alertMessage</span><br><span class="line">        <span class="keyword">self</span>.present(alertController, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">(router: Router, userInfo: Any?)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  MARK: - Pirvate Function</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutViews</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> viewHeight: <span class="type">CGFloat</span> = <span class="number">45</span></span><br><span class="line">        <span class="keyword">let</span> viewMargin: <span class="type">CGFloat</span> = <span class="number">30</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.jumpButton.snp.makeConstraints &#123; [<span class="keyword">unowned</span> <span class="keyword">self</span>] maker <span class="keyword">in</span></span><br><span class="line">            maker.height.equalTo(viewHeight)</span><br><span class="line">            maker.<span class="keyword">left</span>.<span class="keyword">right</span>.equalTo(<span class="keyword">self</span>.view).inset(<span class="type">UIEdgeInsets</span>(top: <span class="number">0</span>, <span class="keyword">left</span>: viewMargin * <span class="number">0.5</span>, bottom: <span class="number">0</span>, <span class="keyword">right</span>: viewMargin))</span><br><span class="line">            maker.bottom.equalTo(<span class="keyword">self</span>.view.snp.centerY).offset(-viewMargin)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.loginButton.snp.makeConstraints &#123; [<span class="keyword">unowned</span> <span class="keyword">self</span>] maker <span class="keyword">in</span></span><br><span class="line">            maker.height.<span class="keyword">left</span>.<span class="keyword">right</span>.equalTo(<span class="keyword">self</span>.jumpButton)</span><br><span class="line">            maker.top.equalTo(<span class="keyword">self</span>.view.snp.centerY).offset(viewMargin * <span class="number">0.5</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.userNameInput.snp.makeConstraints &#123; [<span class="keyword">unowned</span> <span class="keyword">self</span>] maker <span class="keyword">in</span></span><br><span class="line">            maker.height.<span class="keyword">left</span>.<span class="keyword">right</span>.equalTo(<span class="keyword">self</span>.jumpButton)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.passwordInput.snp.makeConstraints &#123; [<span class="keyword">unowned</span> <span class="keyword">self</span>] maker <span class="keyword">in</span></span><br><span class="line">            maker.height.<span class="keyword">left</span>.<span class="keyword">right</span>.equalTo(<span class="keyword">self</span>.jumpButton)</span><br><span class="line">            maker.top.equalTo(<span class="keyword">self</span>.userNameInput.snp.bottom).offset(viewMargin)</span><br><span class="line">            maker.bottom.equalTo(<span class="keyword">self</span>.jumpButton.snp.top).offset(-viewMargin)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">initButton</span><span class="params">(<span class="number">_</span> button: UIButton, title: String, onClick: Selector)</span></span> -&gt; <span class="type">UIButton</span> &#123;</span><br><span class="line">        button.setTitle(title, <span class="keyword">for</span>: .normal)</span><br><span class="line">        button.backgroundColor = <span class="type">UIColor</span>.orange</span><br><span class="line">        button.layer.masksToBounds = <span class="literal">true</span></span><br><span class="line">        button.layer.cornerRadius = <span class="number">8</span></span><br><span class="line">        button.setTitleColor(<span class="type">UIColor</span>.white, <span class="keyword">for</span>: .normal)</span><br><span class="line">        button.setTitleColor(<span class="type">UIColor</span>.gray, <span class="keyword">for</span>: .highlighted)</span><br><span class="line">        button.addTarget(<span class="keyword">self</span>.buttonListener, action: onClick, <span class="keyword">for</span>: .touchUpInside)</span><br><span class="line">        <span class="keyword">return</span> button</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">initTextField</span><span class="params">(<span class="number">_</span> textField: UITextField, placeHolder: String)</span></span> -&gt; <span class="type">UITextField</span> &#123;</span><br><span class="line">        textField.backgroundColor = <span class="type">UIColor</span>.green</span><br><span class="line">        textField.textColor = <span class="type">UIColor</span>.darkGray</span><br><span class="line">        textField.layer.masksToBounds = <span class="literal">true</span></span><br><span class="line">        textField.layer.cornerRadius = <span class="number">8</span></span><br><span class="line">        textField.placeholder = placeHolder</span><br><span class="line">        <span class="keyword">return</span> textField</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  MARK: - Lazy</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> jumpButton: <span class="type">UIButton</span> = &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.initButton($<span class="number">0</span>, title: <span class="string">"跳转"</span>, onClick: #selector(<span class="type">OneViewButtonListener</span>.onJumpButtonClick))</span><br><span class="line">    &#125;(<span class="type">UIButton</span>())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> loginButton: <span class="type">UIButton</span> = &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.initButton($<span class="number">0</span>, title: <span class="string">"登录"</span>, onClick: #selector(<span class="type">OneViewButtonListener</span>.onLoginButtonClick))</span><br><span class="line">    &#125;(<span class="type">UIButton</span>())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> userNameInput: <span class="type">UITextField</span> = &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.initTextField($<span class="number">0</span>, placeHolder: <span class="string">"用户名"</span>)</span><br><span class="line">    &#125;(<span class="type">UITextField</span>())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> passwordInput: <span class="type">UITextField</span> = &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.initTextField($<span class="number">0</span>, placeHolder: <span class="string">"密码"</span>)</span><br><span class="line">    &#125;(<span class="type">UITextField</span>())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> alertController: <span class="type">UIAlertController</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> action = <span class="type">UIAlertAction</span>(title: <span class="string">"确认"</span>, style: .<span class="keyword">default</span>, handler: <span class="literal">nil</span>)</span><br><span class="line">        $<span class="number">0</span>.addAction(action)</span><br><span class="line">        <span class="keyword">return</span> $<span class="number">0</span></span><br><span class="line">    &#125;(<span class="type">UIAlertController</span>(title: <span class="string">"登录提示"</span>, message: <span class="literal">nil</span>, preferredStyle: .alert))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  MARK: - Button Listener</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> buttonListener: <span class="type">OneViewButtonListener</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  MARK: - Event</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesBegan</span><span class="params">(<span class="number">_</span> touches: Set&lt;UITouch&gt;, with event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.view.endEditing(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fileprivate <span class="class"><span class="keyword">class</span> <span class="title">OneViewButtonListener</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> jumpButtonClickCallback: () -&gt; ()</span><br><span class="line">    <span class="keyword">let</span> loginButtonClickCallback: () -&gt; ()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(jump: @escaping () -&gt; (), login: @escaping () -&gt; ()) &#123;</span><br><span class="line">        <span class="keyword">self</span>.jumpButtonClickCallback = jump</span><br><span class="line">        <span class="keyword">self</span>.loginButtonClickCallback = login</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">onJumpButtonClick</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.jumpButtonClickCallback()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">onLoginButtonClick</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.loginButtonClickCallback()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>View</code>中，进行的是视图的显示、布局以及用户事件的转发，可以看到，当两个按钮被用户点击时，<code>Interactor</code>的<code>refresh(request:)</code>方法会被调用，事件及数据转发到了<code>Interactor</code>中。</p>
<h4 id="Interactor"><a href="#Interactor" class="headerlink" title="Interactor"></a>Interactor</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> Moya</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OneInteractor</span>: <span class="title">Interactor</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> provider: <span class="type">MoyaProvider</span>&lt;<span class="type">NetworkRequest</span>&gt; = <span class="type">MoyaProvider</span>&lt;<span class="type">NetworkRequest</span>&gt;()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">refresh</span><span class="params">(request: Request)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> request = request <span class="keyword">as</span>! <span class="type">OneRequest</span></span><br><span class="line">        <span class="keyword">switch</span> request &#123;</span><br><span class="line">        <span class="keyword">case</span> .jump:</span><br><span class="line">            <span class="keyword">self</span>.presenter.present(response: <span class="type">OneResponse</span>.jumpResponse(viper: .two))</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .login(userName, password):</span><br><span class="line">            <span class="keyword">self</span>.provider.request(.login(userName: userName, password: password), completion: &#123; result <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">var</span> json: <span class="type">Any</span>? = <span class="literal">nil</span></span><br><span class="line">                <span class="keyword">switch</span> result &#123;</span><br><span class="line">                <span class="keyword">case</span> .failure: ()</span><br><span class="line">                <span class="keyword">case</span> <span class="keyword">let</span> .success(response):</span><br><span class="line">                    json = <span class="keyword">try</span>? response.mapJSON()</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">self</span>.presenter.present(response: <span class="type">OneResponse</span>.loginResponse(json: json))</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里，我们接收到上一层<code>View</code>传来的请求数据，根据这些请求，我们进一步处理：</p>
<ul>
<li>当接收到跳转请求时，通知展示器进行路由跳转</li>
<li>当接收到登录请求是，向网络发送请求，并将得到的请求结果json数据传递到展示器要求其进行解析。</li>
</ul>
<h4 id="Presenter"><a href="#Presenter" class="headerlink" title="Presenter"></a>Presenter</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> Argo</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnePresenter</span>: <span class="title">Presenter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(response: Response)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> response = response <span class="keyword">as</span>! <span class="type">OneResponse</span></span><br><span class="line">        <span class="keyword">switch</span> response &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .jumpResponse(viper):</span><br><span class="line">            <span class="keyword">self</span>.router?.route(type: .modal(identifier: viper.identifier), userInfo: <span class="string">"From One To Two | One --&gt; Two"</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .loginResponse(json):</span><br><span class="line">            <span class="keyword">var</span> alertMessage = <span class="string">""</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> json = json &#123;</span><br><span class="line">                <span class="keyword">let</span> networkResponse: <span class="type">NetworkResponse</span> = decode(json)!</span><br><span class="line">                <span class="keyword">switch</span> networkResponse &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="keyword">let</span> .faild(message):</span><br><span class="line">                    alertMessage = <span class="string">"登录失败,\(message)"</span></span><br><span class="line">                <span class="keyword">case</span> <span class="keyword">let</span> .success(user):</span><br><span class="line">                    alertMessage = <span class="string">"登录成功,\(user)"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                alertMessage = <span class="string">"网络请求或数据解析错误"</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">self</span>.view?.display(viewModel: <span class="type">OneViewModel</span>(alertMessage: alertMessage))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>展示器可通过自身的路由器属性进行页面的跳转，在跳转时能够向目标视图传递数据，就想这里我们向目标试图传递了一串字符串。当接收到上一层<code>Interactor</code>的原始数据后，展示器进行解析处理，然后最后输出能够直接应用于视图显示的视图模型<code>ViewModel</code>，通知视图层去显示。</p>
<h3 id="Two-联合体"><a href="#Two-联合体" class="headerlink" title="Two 联合体"></a>Two 联合体</h3><p>Two 联合体相对较简单，这里我只列出了代码，不做解释。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  MARK: - View</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TwoView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> showMessage: <span class="type">String</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="keyword">self</span>.view.backgroundColor = <span class="type">UIColor</span>.orange</span><br><span class="line">        <span class="keyword">self</span>.view.addSubview(<span class="keyword">self</span>.showView)</span><br><span class="line">        <span class="keyword">self</span>.showView.snp.makeConstraints &#123; [<span class="keyword">unowned</span> <span class="keyword">self</span>] maker <span class="keyword">in</span></span><br><span class="line">            maker.center.equalTo(<span class="keyword">self</span>.view)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.showView.text = <span class="keyword">self</span>.showMessage</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">(router: Router, userInfo: Any?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.showMessage = userInfo <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  MARK: - Lazy</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> showView: <span class="type">UILabel</span> = &#123;</span><br><span class="line">        $<span class="number">0</span>.textColor = <span class="type">UIColor</span>.white</span><br><span class="line">        $<span class="number">0</span>.font = <span class="type">UIFont</span>.systemFont(ofSize: <span class="number">23</span>)</span><br><span class="line">        $<span class="number">0</span>.textAlignment = .center</span><br><span class="line">        <span class="keyword">return</span> $<span class="number">0</span></span><br><span class="line">    &#125;(<span class="type">UILabel</span>())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesBegan</span><span class="params">(<span class="number">_</span> touches: Set&lt;UITouch&gt;, with event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.interator.refresh(request: <span class="type">TwoRequest</span>.back)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  Status Bar Style</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> preferredStatusBarStyle: <span class="type">UIStatusBarStyle</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .lightContent</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  MARK: - Interactor</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TwoInteractor</span>: <span class="title">Interactor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">refresh</span><span class="params">(request: Request)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.presenter.present(response: <span class="type">TwoResponse</span>.back)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  MARK: - Presenter</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TwoPresenter</span>: <span class="title">Presenter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(response: Response)</span></span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> response <span class="keyword">as</span>! <span class="type">TwoResponse</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .back:</span><br><span class="line">            <span class="keyword">self</span>.router?.route(type: .back, userInfo: <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="AppDelegate"><a href="#AppDelegate" class="headerlink" title="AppDelegate"></a>AppDelegate</h3><p>最后，我们需要在<code>AppDelegate</code>中进行应用程序初始化配置：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="comment">//  Init Window</span></span><br><span class="line">    <span class="keyword">let</span> window = <span class="type">UIWindow</span>(frame: <span class="type">UIScreen</span>.main.bounds)</span><br><span class="line">    window.backgroundColor = <span class="type">UIColor</span>.white</span><br><span class="line">    window.makeKeyAndVisible()</span><br><span class="line">    <span class="keyword">self</span>.window = window</span><br><span class="line">    <span class="comment">//  Init Binder</span></span><br><span class="line">    <span class="type">BinderHelper</span>.initBinder()</span><br><span class="line">    <span class="comment">//  Router</span></span><br><span class="line">    <span class="type">Router</span>().route(type: .root(identifier: <span class="type">VIPERs</span>.one.identifier), userInfo: <span class="literal">nil</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>到此为止，整个基于<code>VIPER</code>架构的小Demo就完成了。</p>
<h2 id="总结-amp-链接"><a href="#总结-amp-链接" class="headerlink" title="总结 &amp; 链接"></a>总结 &amp; 链接</h2><p>本文架构设计灵感源于<a href="http://weibo.com/u/1840543654" target="_blank" rel="external">@罗琦aidenluo</a>的<code>VIP</code>架构设计思想，在这里我也感谢大神的指点，让我对<code>VIPER</code>架构有着更深层的了解。</p>
<p>本人为iOS开发菜鸟一只，若文章中某些话语不严谨或出现技术性错误，还请各位提点意见，也欢迎各位在评论区进行讨论，在这里也祝大家冬日愉快~</p>
<p>文章中实例的Github链接：<a href="https://github.com/TangentW/TanVIPER" target="_blank" rel="external">TanVIPER</a></p>

    
  </div>
</article>

</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal-one" aria-hidden="true">
  <a href="#close" class="cover" aria-hidden="true"></a>
  <div class="modal-dialog">
    <div class="modal-header">
      <a href="#close" class="btn-close" aria-hidden="true">关闭</a>
    </div>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/project/"
              target="_self"
              >
              GitHub
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              target="_self"
              >
              关于
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              target="_self"
              >
              友链
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    
  <section class="duoshuo-comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="" data-title="探究在iOS开发中实现VIPER架构" data-url="http://yoursite.com/2016/12/07/探究在iOS开发中实现VIPER架构/index.html"></div>
    <!-- 多说评论框 end -->
  </section>




  <script type="text/javascript">
  var duoshuoQuery = {short_name:"tangentw"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>


  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?398', function() {
      // load success
    });
  }
</script>

</body>
</html>
